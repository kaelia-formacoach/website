<header class="bg-white shadow-lg py-2 relative z-50">
  <div class="container mx-auto flex items-center justify-between px-6">
    <!-- Menu de gauche (caché sur mobile) -->
    <nav class="hidden md:flex space-x-6">
      <!-- Menu "Formations" avec sous-menu -->
      <div class="relative">
        <button
          id="formations-desktop-btn"
          data-path="/formations"
          class="menu-link text-xl text-gray-700 hover:text-purple-600 focus:text-gray-700 transition focus:outline-none"
          aria-haspopup="true"
          aria-expanded="false"
        >
          Nos Offres
        </button>
        <!-- Sous-menu pour desktop -->
        <div
  id="formations-desktop-submenu"
  class="absolute left-0 mt-2 bg-white border rounded shadow-lg hidden"
  role="menu"
  aria-label="Sous-menu Formations"
>
  <a
    href="/formations/nos-formations"
    class="block px-4 py-2 text-gray-700 hover:bg-purple-100 transition menu-link whitespace-nowrap"
    role="menuitem"
  >
    Nos Formations & Coaching
  </a>
  <a
    href="/formations/sur-mesure"
    class="block px-4 py-2 text-gray-700 hover:bg-purple-100 transition menu-link"
    role="menuitem"
  >
    Sur Mesure
  </a>
</div>
      </div>

      <!-- Nouveau lien "Financement" -->
      <a
        href="/financement"
        class="text-xl menu-link text-gray-700 hover:text-purple-600 transition"
        role="menuitem"
      >
        Financement
      </a>

      <a
        href="/inside-kaelia"
        class="text-xl menu-link text-gray-700 hover:text-purple-600 transition"
        role="menuitem"
      >
        Inside Kaelia
      </a>
    </nav>

    <!-- Logo centré -->
    <a href="/" class="mx-auto">
      <img
        src="/images/header/logo-kaelia.png"
        alt="Kaelia Logo"
        class="h-20 md:h-24"
      />
    </a>

    <!-- Menu de droite (caché sur mobile) -->
    <nav class="hidden md:flex space-x-6">
      <a
        href="/le-klub"
        class="text-xl menu-link text-gray-700 hover:text-purple-600 transition"
        role="menuitem"
      >
        Le Klub
      </a>
      <a
        href="/contact"
        class="text-xl menu-link text-gray-700 hover:text-purple-600 transition"
        role="menuitem"
      >
        Contact
      </a>

      <!-- Nouveau lien "Nous rejoindre" -->
      <a
        href="/nous-rejoindre"
        class="text-xl menu-link text-gray-700 hover:text-purple-600 transition"
        role="menuitem"
      >
        Nous rejoindre
      </a>
    </nav>

    <!-- Bouton hamburger pour les petits écrans -->
    <button
      id="menu-btn"
      class="md:hidden text-gray-700 focus:outline-none"
      aria-label="Ouvrir le menu"
    >
      <svg
        id="hamburger-icon"
        class="h-8 w-8 transition-transform"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M4 6h16M4 12h16M4 18h16"></path>
      </svg>
    </button>
  </div>

  <!-- Menu mobile en plein écran avec animation -->
  <div
    id="mobile-menu"
    class="fixed inset-0 bg-white flex flex-col items-start justify-center space-y-6 text-lg text-gray-700 z-40 transform -translate-y-full transition-transform duration-300 ease-in-out px-6"
    role="menu"
    aria-label="Menu Mobile"
  >
    <!-- Bouton pour fermer le menu mobile -->
    <button
      id="close-menu-btn"
      class="absolute top-4 right-4 text-gray-700 focus:outline-none"
      aria-label="Fermer le menu"
    >
      <svg
        class="h-8 w-8"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>

    <!-- Nouveau menu Accueil ajouté pour mobile -->
    <a
      href="/"
      class="menu-link text-gray-700 hover:text-purple-600 transition text-xl"
      role="menuitem"
    >
      Accueil
    </a>

    <!-- Menu "Formations" avec sous-menu pour mobile -->
    <div class="w-full">
      <button
        id="formations-mobile-btn"
        data-path="/formations"
        class="menu-link w-full text-left text-gray-700 hover:text-purple-600 focus:text-gray-700 transition focus:outline-none"
        aria-haspopup="true"
        aria-expanded="false"
      >
        Formations
      </button>
      <div
        id="formations-mobile-submenu"
        class="mt-2 hidden flex-col space-y-4 pl-4"
        role="menu"
        aria-label="Sous-menu Formations Mobile"
      >
        <a
          href="/formations/nos-formations"
          class="block text-gray-700 hover:text-purple-600 transition text-lg menu-link"
          role="menuitem"
        >
          Nos Formations
        </a>
        <a
          href="/formations/sur-mesure"
          class="block text-gray-700 hover:text-purple-600 transition text-lg menu-link"
          role="menuitem"
        >
          Sur Mesure
        </a>
      </div>
    </div>

    <!-- Nouveau lien "Financement" pour mobile -->
    <a
      href="/financement"
      class="menu-link text-gray-700 hover:text-purple-600 transition text-xl"
      role="menuitem"
    >
      Financement
    </a>

    <a
      href="/inside-kaelia"
      class="menu-link text-gray-700 hover:text-purple-600 transition text-xl"
      role="menuitem"
    >
      Inside Kaelia
    </a>
    <a
      href="/le-klub"
      class="menu-link text-gray-700 hover:text-purple-600 transition text-xl"
      role="menuitem"
    >
      Le Klub
    </a>
    <a
      href="/contact"
      class="menu-link text-gray-700 hover:text-purple-600 transition text-xl"
      role="menuitem"
    >
      Contact
    </a>

    <!-- Nouveau lien "Nous rejoindre" pour mobile -->
    <a
      href="/nous-rejoindre"
      class="menu-link text-gray-700 hover:text-purple-600 transition text-xl"
      role="menuitem"
    >
      Nous rejoindre
    </a>
  </div>
</header>

<!-- Script JavaScript Corrigé -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const menuBtn = document.getElementById("menu-btn");
    const mobileMenu = document.getElementById("mobile-menu");
    const menuLinks = document.querySelectorAll(".menu-link"); // Sélectionner tous les éléments avec la classe 'menu-link'
    const closeMenuBtn = document.getElementById("close-menu-btn");
    const formationsDesktopBtn = document.getElementById(
      "formations-desktop-btn"
    );
    const formationsDesktopSubmenu = document.getElementById(
      "formations-desktop-submenu"
    );
    const formationsMobileBtn = document.getElementById(
      "formations-mobile-btn"
    );
    const formationsMobileSubmenu = document.getElementById(
      "formations-mobile-submenu"
    );

    // Fonction pour fermer tous les sous-menus
    function closeAllSubmenus() {
      // Desktop
      if (formationsDesktopSubmenu && formationsDesktopBtn) {
        formationsDesktopSubmenu.classList.add("hidden");
        formationsDesktopBtn.setAttribute("aria-expanded", "false");
      }
      // Mobile
      if (formationsMobileSubmenu && formationsMobileBtn) {
        formationsMobileSubmenu.classList.add("hidden");
        formationsMobileBtn.setAttribute("aria-expanded", "false");
      }
    }

    // Afficher/Masquer le menu mobile avec animation au clic
    if (menuBtn && mobileMenu) {
      menuBtn.addEventListener("click", (e) => {
        e.stopPropagation(); // Empêcher la propagation pour éviter de fermer immédiatement le menu
        mobileMenu.classList.toggle("open");
        menuBtn.classList.toggle("active");
        // Fermer tous les sous-menus lorsque le menu principal est fermé
        if (!mobileMenu.classList.contains("open")) {
          closeAllSubmenus();
        }
      });
    }

    // Fermer le menu mobile au clic sur le bouton de fermeture
    if (closeMenuBtn && mobileMenu) {
      closeMenuBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        mobileMenu.classList.remove("open");
        if (menuBtn) menuBtn.classList.remove("active");
        closeAllSubmenus();
      });
    }

    // Gestion du sous-menu "Formations" dans le menu desktop
    if (formationsDesktopBtn && formationsDesktopSubmenu) {
      formationsDesktopBtn.addEventListener("click", (e) => {
        e.preventDefault(); // Empêcher le comportement par défaut du bouton
        e.stopPropagation(); // Empêcher la propagation pour éviter de fermer le menu
        const isHidden = formationsDesktopSubmenu.classList.contains("hidden");
        if (isHidden) {
          formationsDesktopSubmenu.classList.remove("hidden");
          formationsDesktopBtn.setAttribute("aria-expanded", "true");
        } else {
          formationsDesktopSubmenu.classList.add("hidden");
          formationsDesktopBtn.setAttribute("aria-expanded", "false");
        }
      });
    }

    // Gestion du sous-menu "Formations" dans le menu mobile
    if (formationsMobileBtn && formationsMobileSubmenu) {
      formationsMobileBtn.addEventListener("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        formationsMobileSubmenu.classList.toggle("hidden");
        const isExpanded =
          !formationsMobileSubmenu.classList.contains("hidden");
        formationsMobileBtn.setAttribute(
          "aria-expanded",
          isExpanded.toString()
        );
      });
    }

    // Fermer les sous-menus si l'utilisateur clique en dehors
    document.addEventListener("click", function (event) {
      // Vérifier que event.target est un Node
      if (!(event.target instanceof Node)) {
        return;
      }

      const isClickInsideDesktop =
        formationsDesktopBtn?.contains(event.target) ||
        formationsDesktopSubmenu?.contains(event.target);
      const isClickInsideMobile =
        formationsMobileBtn?.contains(event.target) ||
        formationsMobileSubmenu?.contains(event.target);
      const isClickInsideMenu =
        mobileMenu?.contains(event.target) || menuBtn?.contains(event.target);

      if (!isClickInsideDesktop) {
        if (formationsDesktopSubmenu && formationsDesktopBtn) {
          formationsDesktopSubmenu.classList.add("hidden");
          formationsDesktopBtn.setAttribute("aria-expanded", "false");
        }
      }

      if (!isClickInsideMobile && !isClickInsideMenu) {
        if (formationsMobileSubmenu && formationsMobileBtn) {
          formationsMobileSubmenu.classList.add("hidden");
          formationsMobileBtn.setAttribute("aria-expanded", "false");
        }
      }
    });

    // Récupérer l'URL actuelle et retirer le dernier / si ce n'est pas la racine
    let currentPath = window.location.pathname;
    if (currentPath.length > 1 && currentPath.endsWith("/")) {
      currentPath = currentPath.slice(0, -1);
    }

    // Boucler sur chaque lien et ajouter la classe 'active' si l'URL correspond ou commence par le href ou data-path
    menuLinks.forEach((link) => {
      let linkPath =
        link.getAttribute("href") || link.getAttribute("data-path");

      if (linkPath) {
        // Retirer le dernier / si ce n'est pas la racine
        if (linkPath.length > 1 && linkPath.endsWith("/")) {
          linkPath = linkPath.slice(0, -1);
        }

        if (linkPath === "/") {
          // Pour le lien "Accueil", activer uniquement si on est sur '/'
          if (currentPath === "/") {
            link.classList.add("active");
          }
        } else {
          // Pour les autres liens, activer si le chemin correspond ou commence par le lienPath
          if (
            currentPath === linkPath ||
            currentPath.startsWith(linkPath + "/")
          ) {
            // Vérifier si le lien est un sous-menu
            const isSubmenuItem =
              link.closest("#formations-desktop-submenu") ||
              link.closest("#formations-mobile-submenu");

            // N'ajouter 'active' que si ce n'est pas un sous-menu
            if (!isSubmenuItem) {
              link.classList.add("active");
            }

            // Ouvrir les sous-menus si nécessaire
            if (link.closest("#formations-desktop-submenu")) {
              if (formationsDesktopSubmenu && formationsDesktopBtn) {
                formationsDesktopSubmenu.classList.remove("hidden");
                formationsDesktopBtn.setAttribute("aria-expanded", "true");
              }
            }
            if (link.closest("#formations-mobile-submenu")) {
              if (formationsMobileSubmenu && formationsMobileBtn) {
                formationsMobileSubmenu.classList.remove("hidden");
                formationsMobileBtn.setAttribute("aria-expanded", "true");
              }
            }
          }
        }
      }

      // Ajouter l'événement de clic pour changer l'état actif
      link.addEventListener("click", function () {
        // Supprimer la classe active de tous les liens
        menuLinks.forEach((l) => l.classList.remove("active"));

        // Ajouter la classe active au lien cliqué s'il n'est pas un sous-menu
        const isSubmenuItem =
          link.closest("#formations-desktop-submenu") ||
          link.closest("#formations-mobile-submenu");
        if (!isSubmenuItem) {
          link.classList.add("active");
        }

        // Fermer le menu mobile après la sélection d'un lien
        if (mobileMenu && mobileMenu.classList.contains("open")) {
          mobileMenu.classList.remove("open");
          if (menuBtn) menuBtn.classList.remove("active");
          closeAllSubmenus();
        }
      });
    });
  });
</script>

<style>
  /* Styles pour les liens actifs uniquement */
  .menu-link.active {
    color: #6b46c1; /* Violet */
    font-weight: bold;
    text-decoration: underline;
    text-underline-offset: 4px;
  }

  /* Styles du menu mobile pour un espacement plus grand et un look épuré */
  #mobile-menu {
    padding-left: 1.5rem; /* Ajout de padding à gauche pour l'alignement */
    padding-right: 1.5rem; /* Ajout de padding à droite pour l'alignement */
  }

  #mobile-menu a.menu-link {
    padding: 0.75rem 0;
    font-size: 1.25rem; /* Taille de texte légèrement plus grande */
  }

  /* Transition pour le bouton hamburger */
  #menu-btn svg {
    transition: transform 0.3s;
  }
  #menu-btn.active svg {
    transform: rotate(90deg); /* Rotation pour indiquer l'ouverture */
  }

  /* Animation pour le menu mobile */
  #mobile-menu {
    /* État initial : déplacé vers le haut hors de la vue */
    transform: translateY(-100%);
    transition: transform 0.3s ease-in-out;
  }
  #mobile-menu.open {
    /* Lorsque ouvert : en place */
    transform: translateY(0);
  }

  /* Styles pour le sous-menu desktop */
  #formations-desktop-submenu {
    /* Positionnement */
    top: 100%;
    left: 0;
    /* Apparence */
    background-color: white;
    border: 1px solid #e2e8f0; /* Border-gray-200 */
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
    /* Transition */
    transition:
      opacity 0.3s ease,
      visibility 0.3s ease;
    z-index: 50;
  }

  /* Montrer le sous-menu desktop lorsqu'open est présent */
  .relative.open #formations-desktop-submenu {
    display: block;
  }

  /* Styles pour le sous-menu mobile */
  #formations-mobile-submenu a.menu-link {
    padding-left: 1rem; /* Indentation pour les sous-menus */
  }

  /* Bouton "Formations" dans le menu mobile */
  #formations-mobile-btn {
    width: 100%; /* Occuper toute la largeur */
    text-align: left; /* Aligner le texte à gauche */
    padding: 0.75rem 0; /* Espacement vertical */
    font-size: 1.25rem; /* Taille de texte */
  }

  /* Bouton "Formations" hover state */
  #formations-mobile-btn:hover {
    color: #6b46c1; /* Changer la couleur au survol */
  }

  /* Bouton "Formations" active state */
  #formations-mobile-btn:focus {
    color: #6b46c1; /* Changer la couleur lors du focus */
  }

  /* Ajustements supplémentaires pour une meilleure apparence */
  #mobile-menu button#formations-mobile-btn {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
</style>
